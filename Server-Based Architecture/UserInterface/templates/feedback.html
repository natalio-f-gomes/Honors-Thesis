{% extends 'statics/base.html' %}
{% load static %}

{% block title %}Leave Feedback - ResumeScanner{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <!-- Page Header -->
        <div class="col-12 mb-5">
            <div class="page-header text-center animate-fade-in">
                <div class="profile-avatar mx-auto mb-3" style="width: 80px; height: 80px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);">
                    <i class="fas fa-comment-dots fa-2x text-white"></i>
                </div>
                <h2 class="display-5 fw-bold mb-2" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    Share Your Feedback
                </h2>
                <p class="text-muted">Your opinion helps us improve our service</p>
            </div>
        </div>

        {% if user.is_authenticated %}
            <div class="col-lg-8 col-xl-6">
                <div class="card border-0 shadow-lg animate-fade-in" style="border-radius: 25px; overflow: hidden;">
                    <div class="card-header text-white py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="d-flex align-items-center">
                            <div class="icon-circle me-3" style="width: 50px; height: 50px; background: rgba(255, 255, 255, 0.2);">
                                <i class="fas fa-star text-white"></i>
                            </div>
                            <div>
                                <h5 class="mb-1 fw-bold">Feedback Form</h5>
                                <p class="mb-0 opacity-75">Tell us about your experience</p>
                            </div>
                        </div>
                    </div>

                    <div class="card-body p-5" style="background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);">
                        <!-- Rating Section -->
                        <div class="rating-section mb-4 text-center">
                            <h6 class="mb-3 fw-bold text-primary">
                                <i class="fas fa-star me-2"></i>Rate Your Experience
                            </h6>
                            <div class="rating-stars mb-3" style="font-size: 2rem;">
                                <i class="far fa-star text-warning me-1" data-rating="1" style="cursor: pointer; transition: all 0.3s ease;"></i>
                                <i class="far fa-star text-warning me-1" data-rating="2" style="cursor: pointer; transition: all 0.3s ease;"></i>
                                <i class="far fa-star text-warning me-1" data-rating="3" style="cursor: pointer; transition: all 0.3s ease;"></i>
                                <i class="far fa-star text-warning me-1" data-rating="4" style="cursor: pointer; transition: all 0.3s ease;"></i>
                                <i class="far fa-star text-warning" data-rating="5" style="cursor: pointer; transition: all 0.3s ease;"></i>
                            </div>
                            <p class="text-muted small" id="rating-text">Click on the stars to rate</p>
                        </div>

                        <form action="{% url 'feedback' user_id %}" method="POST" class="feedback-form" id="feedbackForm">
                            {% csrf_token %}

                            <!-- Hidden rating input -->
                            {{ feedback_form.rating }}

                            <!-- Category Field -->
                            <div class="form-section mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <div class="icon-circle me-3" style="width: 40px; height: 40px; background: linear-gradient(135deg, #6f42c1, #8b5cf6);">
                                        <i class="fas fa-tag text-white"></i>
                                    </div>
                                    <label class="form-label fw-semibold mb-0" for="{{ feedback_form.category.id_for_label }}">Category</label>
                                </div>
                                <div class="ms-5">
                                    {{ feedback_form.category }}
                                    {% if feedback_form.category.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in feedback_form.category.errors %}
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>


                        <!-- Feedback Field - FIXED VERSION -->
                        <div class="form-section mb-4">
                            <div class="d-flex align-items-center mb-3">
                                <div class="icon-circle me-3" style="width: 40px; height: 40px; background: linear-gradient(135deg, #fd7e14, #ff6b35);">
                                    <i class="fas fa-comment-alt text-white"></i>
                                </div>
                                <label class="form-label fw-semibold mb-0" for="{{ feedback_form.message.id_for_label }}">Your Feedback</label>
                            </div>
                            <div class="ms-5">
                                {{ feedback_form.message }}
                                {% if feedback_form.message.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in feedback_form.message.errors %}
                                            <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                                <small class="text-muted mt-2 d-block">
                                    <i class="fas fa-info-circle me-1"></i>Minimum 10 characters, maximum 1000 characters
                                </small>
                            </div>
                        </div>


                            <!-- Form Errors -->
                            {% if feedback_form.non_field_errors %}
                                <div class="alert alert-danger border-0 rounded-pill mb-4">
                                    {% for error in feedback_form.non_field_errors %}
                                        <i class="fas fa-exclamation-triangle me-2"></i>{{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}

                            <div class="text-center mt-4">
                                <button type="submit" class="btn btn-success btn-lg px-5" style="border-radius: 50px; background: linear-gradient(135deg, #28a745, #20c997); border: none;" id="submitBtn" >
                                    <i class="fas fa-paper-plane me-2"></i>Submit Feedback
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

        {% else %}
            <div class="col-lg-8 col-xl-6">
                <div class="card border-0 shadow-lg animate-fade-in" style="border-radius: 25px;">
                    <div class="card-body p-5 text-center">
                        <div class="alert-icon mb-4" style="width: 80px; height: 80px; background: linear-gradient(135deg, #dc3545, #c82333); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-exclamation-triangle fa-2x text-white"></i>
                        </div>
                        <h4 class="text-danger mb-3 fw-bold">Authentication Required</h4>
                        <p class="text-muted mb-4">Please login to leave feedback and share your experience with us. We value your opinion and want to make sure your feedback is properly attributed.</p>
                        <p class="text-muted mb-4"><strong>Please be respectful</strong> when providing feedback.</p>
                        <a href="{% url 'login' %}" class="btn btn-danger btn-lg px-5" style="border-radius: 50px; background: linear-gradient(135deg, #dc3545, #c82333); border: none;">
                            <i class="fas fa-sign-in-alt me-2"></i>Login to Continue
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<style>
    .page-header {
        animation: fadeInUp 0.8s ease-out;
    }

    .card {
        transition: all 0.3s ease;
        animation: fadeInUp 0.6s ease-out;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 35px rgba(0,0,0,0.1) !important;
    }

    .form-section {
        padding: 1.5rem;
        border-radius: 15px;
        background: rgba(102, 126, 234, 0.05);
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .form-section:hover {
        background: rgba(102, 126, 234, 0.1);
        transform: translateX(5px);
    }

    .icon-circle {
        transition: all 0.3s ease;
    }

    .icon-circle:hover {
        transform: scale(1.1) rotate(5deg);
    }

    .rating-stars i {
        transition: all 0.3s ease;
    }

    .rating-stars i:hover {
        transform: scale(1.2);
        text-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
    }

    .rating-stars i.selected {
        color: #ffc107 !important;
    }

    .btn {
        transition: all 0.3s ease;
    }

    .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        background: linear-gradient(135deg, #6c757d, #495057) !important;
    }

    /* Form styling */
    .form-control, .form-select {
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        background: white;
    }

    .rating-section {
        padding: 2rem;
        border-radius: 20px;
        background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(224, 168, 0, 0.1));
        border: 2px solid rgba(255, 193, 7, 0.2);
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in {
        animation: fadeInUp 0.8s ease-out;
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
        .form-section {
            padding: 1rem;
        }

        .ms-5 {
            margin-left: 0 !important;
            margin-top: 1rem;
        }

        .d-flex.align-items-center {
            flex-direction: column;
            text-align: center;
        }

        .icon-circle.me-3 {
            margin-right: 0 !important;
            margin-bottom: 1rem;
        }
    }
</style>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('.rating-stars i');
        const ratingInput = document.getElementById('id_rating');
        const submitBtn = document.getElementById('submitBtn');
        const ratingText = document.getElementById('rating-text');
        const form = document.getElementById('feedbackForm');

        let selectedRating = 0;

        // Function to update stars display
        function updateStars(rating) {
            selectedRating = parseInt(rating);
            stars.forEach((star, index) => {
                const starRating = parseInt(star.getAttribute('data-rating'));
                if (starRating <= rating) {
                    star.classList.remove('far');
                    star.classList.add('fas', 'selected');
                } else {
                    star.classList.remove('fas', 'selected');
                    star.classList.add('far');
                }
            });

            // Update hidden input
            ratingInput.value = rating;

            // Update rating text
            const ratingTexts = {
                1: "Poor - We need to improve",
                2: "Fair - Below expectations",
                3: "Good - Meets expectations",
                4: "Very Good - Above expectations",
                5: "Excellent - Exceeds expectations"
            };
            ratingText.textContent = ratingTexts[rating] || "Click on the stars to rate";

            // Check if form is valid
            checkFormValidity();
        }

        // Add click event to stars
        stars.forEach(star => {
            star.addEventListener('click', function() {
                const rating = this.getAttribute('data-rating');
                updateStars(rating);
            });

            // Add hover effects
            star.addEventListener('mouseenter', function() {
                const rating = parseInt(this.getAttribute('data-rating'));
                stars.forEach((s, index) => {
                    const r = parseInt(s.getAttribute('data-rating'));
                    if (r <= rating) {
                        s.style.color = '#ffc107';
                        s.style.transform = 'scale(1.2)';
                    }
                });
            });

            star.addEventListener('mouseleave', function() {
                stars.forEach(s => {
                    s.style.transform = 'scale(1)';
                    if (!s.classList.contains('selected')) {
                        s.style.color = 'rgba(255, 193, 7, 0.5)';
                    }
                });
            });
        });

        
function checkFormValidity() {
    const category = document.getElementById('id_category').value;
    const message = document.getElementById('id_message').value.trim(); 

    if (rating && parseInt(rating) >= 1 && category && message.length >= 10) {
        submitBtn.disabled = false;
        submitBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
    } else {
        submitBtn.disabled = true;
        submitBtn.style.background = 'linear-gradient(135deg, #6c757d, #495057)';
    }
}


document.getElementById('id_category').addEventListener('change', checkFormValidity);
document.getElementById('id_message').addEventListener('input', checkFormValidity); 


form.addEventListener('submit', function(e) {
    if (!selectedRating || selectedRating < 1) {
        e.preventDefault();
        alert('Please select a rating before submitting your feedback.');
        return false;
    }

    const message = document.getElementById('id_message').value.trim(); 
    if (message.length < 10) {
        e.preventDefault();
        alert('Please provide at least 10 characters of feedback.');
        return false;
    }

 
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Submitting...';
    submitBtn.disabled = true;
});
    });
</script>
{% endblock %}
{% endblock %}